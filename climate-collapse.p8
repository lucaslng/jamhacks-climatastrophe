pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
black = 0
darkblue = 1
purple = 2
darkgreen = 3
brown = 4
drakgray = 5
lightgray = 6
white = 7
red = 8
orange = 9
yellow = 10
green = 11
blue = 12
lavender = 13
pink = 14
peach = 15

function hcenter(s)
	return 64 - #s * 2
end

function vcenter()
	return 61
end

function clamp(val, lower, upper)
	assert(val and lower and upper, "clamp assert")
	return max(lower, min(upper, val))
end

function dist(x1, y1, x2, y2)
	return sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2))
end

function intro()
	starttime = time()
	print("hello", hcenter("hello"), vcenter(), white)
	while (time() - starttime < 2) do
	end
end

function _init()
	-- cls()
	-- intro()
	cls()
	Player = {
		x = 63,
		y = 63,
		fx = false,
		sprite = 1,
		hunger = 5,
		thirst = 4
	}

	function Player:moveleft(distance)
		self.x -= distance
		self.fx = true
	end

	function Player:moveright(distance)
		self.x += distance
		self.fx = false
	end

	function Player:moveup(distance)
		self.y -= distance
		self.fx = false
	end

	function Player:movedown(distance)
		self.y += distance
		self.fx = false
	end

	function Player:drink(amount)
		self.thirst = clamp(self.thirst + amount, 0, 5)
		-- self.thirst += amount
	end

	function Player:eat(amount)
		self.hunger = clamp(self.hunger + amount, 0, 5)
	end

	function Player:celx()
		return flr(self.x / 8)
	end

	function Player:cely()
		return flr(self.y / 8)
	end

	tornadoes = {}

	Tornado = {
		x = 0,
		y = 0,
		vx = 0,
		vy = 0,
		lifetime = 240
	}

	function Tornado:new()
		o = {}
		setmetatable(o, self)
		self.__index = self
		return o
	end

end

function _update()

	if (btn(0)) Player:moveleft(1)
	if (btn(1)) Player:moveright(1)
	if (btn(2)) Player:moveup(1)
	if (btn(3)) Player:movedown(1)
	
	if btn(4) then
		if mget(Player:celx(), Player:cely()) == 8 then
			Player:drink(1)
		end
	end

	if rnd({0, 1}) == 0 then
		local tornado = Tornado:new()
		tornado.x = Player.x + flr(rnd(160)) - 80
		tornado.y = Player.y + flr(rnd(160)) - 80
		if (tornado.x < Player.x - 64 or tornado.x > Player.x + 64) and (tornado.y < Player.y - 64 or tornado.y > Player.y + 64) then
			tornado.vx = rnd({-2, -1, 0, 1, 2})
			tornado.vy = rnd({-2, -1, 0, 1, 2})
			add(tornadoes, tornado)
		end
	end

	foreach(tornadoes, function (t) t.x += t.vx; t.y += t.vy; t.lifetime -= 1; end)
	if tornadoes[1] != nil and tornadoes[1].lifetime <= 0 then deli(tornadoes, 1) end

end

function _draw()
	cls()

	camera(Player.x - 63, Player.y - 63)
	map(0, 0, 0, 0, 128, 32)
	spr(Player.sprite, Player.x, Player.y, 1, 1, Player.fx)

	foreach(tornadoes, function(t) spr(1, t.x, t.y); end)

	-- draw hud after resetting camera
	camera()

	for i = 1, Player.thirst, 1 do
		spr(5, i * 9 - 3, 14, 2, 2)
	end

	palt(green, true)
	palt(black, false)
	for i = 1, Player.hunger, 1 do
		spr(3, i * 9 - 4, 3, 2, 2)
	end
	palt()
	-- print("" .. Player.x .. " " .. Player.y .. "", 3, 20, white)
end

__gfx__
000000000b3bb3b065555666bbbbbbbbbbbbbbbb000100000000000011411111cccccccc00000000000000000000000000000000000000000000000000000000
000000003bb3bbbb66556665bbb00bbbbbbbbbbb001c10000000000011111111cccccccc00000000000000000000000000000000000000000000000000000000
0070070003333bb066666655bb0880bbbbbbbbbb001c10000000000011111411cccccccc00000000000000000000000000000000000000000000000000000000
0007700000eeee0056655666b08f890bbbbbbbbb01ccc1000000000011111111cccccccc00000000000000000000000000000000000000000000000000000000
0007700002e0e0e066665566b0884490bbbbbbbb01ccc1000000000011111111cccccccc00000000000000000000000000000000000000000000000000000000
00700700022eeee066566666bb044440bbbbbbbb17cccc100000000014111111cccccccc00000000000000000000000000000000000000000000000000000000
000000000022220055665665bbb04440bbbbbbbb17cccc100000000011111114cccccccc00000000000000000000000000000000000000000000000000000000
000000000002200066655556bbbb000700bbbbbb017cc1000000000011111111cccccccc00000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbb070bbbbbb0011100000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbb00bbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000bbbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbb0000bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbb0cccc0bbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb0cbbbbc0bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb0cb77bbbc0bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb0cb7bbbbc0bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb0cbbbbbbc0bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbb0cbbbbbbc0bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb0cbbbbc0bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb70cccc0bbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbb0000bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020208080202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020808080802020202020200000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020808080802020202020200020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020808080202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020808080202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
